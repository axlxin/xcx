<?xml version="1.0" encoding="utf-8"?>
<modification>
    <name>KP Coupon Fixed</name>
    <code>kp_coupon_fixed</code>
    <update>2016-10-08</update>
    <version>1.0.0</version>
    <author>Kevin Pan</author>

    <file path="catalog/model/checkout/coupon.php">
        <operation info="新增加一个函数，直接获取对应code的coupon信息。OC此处会检测购物车的订单信息，故有BUG">
            <search >
	        <![CDATA[public function getCoupon($code) {]]>
            </search>
            <add position="before"><![CDATA[
public function getCouponByCode($code) {
    $query = $this->db->query("SELECT DISTINCT * FROM " . DB_PREFIX . "coupon WHERE code = '" . $this->db->escape($code) . "'");
    return $query->row;
}
]]></add>
        </operation>
    </file>
    
    <file path="catalog/model/total/coupon.php">
        <operation info="修改confirm函数">
            <search >
	        <![CDATA[$coupon_info = $this->model_checkout_coupon->getCoupon($code);]]>
            </search>
            <add position="replace"><![CDATA[
$coupon_info = $this->model_checkout_coupon->getCouponByCode($code);
]]></add>
        </operation>
    </file>

</modification>