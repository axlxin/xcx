<modification>
	<id>Canned Messages</id>
	<version>OC 2</version>
	<vqmver>2.5.0</vqmver>
	<author>Equotix</author>
	<file name="admin/controller/sale/order.php">
		<operation>
			<search position="after"><![CDATA[
				$data['button_history_add'] = $this->language->get('button_history_add');
			]]></search>
			<add><![CDATA[
				$data['entry_canned_message'] = $this->language->get('entry_canned_message');
				
				$this->load->model('module/canned_messages');
				
				$data['canned_messages'] = $this->model_module_canned_messages->getMessages();
			]]></add>
		</operation>
	</file>
	<file name="admin/language/*/sale/order.php">
		<operation>
			<search position="after" index="1"><![CDATA[
				$_
			]]></search>
			<add><![CDATA[
				$_['entry_canned_message'] = 'Canned Message';
			]]></add>
		</operation>
	</file>
	<file name="admin/view/template/sale/order_info.tpl">
		<operation>
			<search position="before"><![CDATA[
				<label class="col-sm-2 control-label" for="input-order-status"><?php echo $entry_order_status; ?></label>
			]]></search>
			<add><![CDATA[
				  <label class="col-sm-2 control-label" for="input-canned-message"><?php echo $entry_canned_message; ?></label>
				  <div class="col-sm-10">
                    <select name="canned_message_id" id="input-canned-message" class="form-control">
					  <option value=""></option>
                      <?php foreach ($canned_messages as $canned_message) { ?>
                      <option value="<?php echo $canned_message['canned_message_id']; ?>"><?php echo $canned_message['name']; ?></option>
                      <?php } ?>
                    </select>
                  </div>
				</div>
				<div class="form-group">
			]]></add>
		</operation>
		<operation>
			<search position="after"><![CDATA[
				<?php echo $footer; ?>
			]]></search>
			<add><![CDATA[
				<script type="text/javascript"><!--
				$('select[name=\'canned_message_id\']').on('change', function() {
					var canned_message_id = $(this).val();
					
					$.ajax({
						url: 'index.php?route=module/canned_messages/info&token=<?php echo $token; ?>&order_id=<?php echo $order_id; ?>&canned_message_id=' + canned_message_id,
						type: 'get',
						dataType: 'json',
						beforeSend: function() {
							$('select[name=\'canned_message_id\']').prop('disabled', true);
						},
						success: function(json) {
							$('select[name=\'canned_message_id\']').prop('disabled', false);
							
							$('select[name=\'order_status_id\']').val(json['order_status_id']);
							$('textarea[name=\'comment\']').val(json['comment']);
							
							if (json['notify'] == '1') {
								$('input[name=\'notify\']').prop('checked', true);
							} else {
								$('input[name=\'notify\']').prop('checked', false);
							}
						},
						error: function(xhr, ajaxOptions, thrownError) {
							alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
						}
					});
				});
				//--></script>
			]]></add>
		</operation>
	</file>
</modification>