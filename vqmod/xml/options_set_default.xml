<?xml version="1.0" encoding="utf-8"?>
<modification>
  <name>Options Set Default (for oc2.x)</name>
  <code>KP-OptionSetDefault</code>
  <version>1.6</version>
  <vqmver required="true">2.5.1</vqmver>
  <author>Kevin</author>
  <link>http://www.opencart.com</link>
  
  <file name="admin/view/template/catalog/product_form.tpl">
        <operation info="Add 'set default' menu into option tab for js">
            <search position="after">
	        <![CDATA[html += '        <td class="text-left"><?php echo $entry_option_value; ?></td>';]]>
            </search>
            <add><![CDATA[html += '        <td class="text-left"><?php echo $text_optionsetdefault; ?></td>';]]></add>
        </operation>
        
        <operation info="Add 'set default' menu into option tab for js">
            <search position="after">
	        <![CDATA[html += '  </select><input type="hidden" name="product_option[' + option_row + '][product_option_value][' + option_value_row + '][product_option_value_id]" value="" /></td>';]]>
            </search>
            <add ><![CDATA[
html += '    <td class="text-left"><select name="product_option[' + option_row + '][product_option_value][' + option_value_row + '][if_default]" class="form-control">';
	html += '      <option value="1"><?php echo $text_yes; ?></option>';
	html += '      <option value="0" selected=""><?php echo $text_no; ?></option>';
	html += '    </select></td>';]]>
            </add>
        </operation>
        
        <operation info="Add 'set default' menu into option tab">
            <search position="replace" offset="3">
	        <![CDATA[<table id="option-value<?php echo $option_row; ?>" class="table table-striped table-bordered table-hover">]]>
            </search>
            <add>
	        <![CDATA[
<table id="option-value<?php echo $option_row; ?>" class="table table-striped table-bordered table-hover">
                          <thead>
                            <tr>
                              <td class="text-left"><?php echo $entry_option_value; ?></td>
                              <td class="text-left"><?php echo $text_optionsetdefault; ?></td>
]]>
            </add>
        </operation>
        
        <operation info="Add td for selection of default option">
            <search position="after">
                <![CDATA[<input type="hidden" name="product_option[<?php echo $option_row; ?>][product_option_value][<?php echo $option_value_row; ?>][product_option_value_id]" value="<?php echo $product_option_value['product_option_value_id']; ?>" /></td>]]>
            </search>
            <add>
                <![CDATA[
                   <td class="text-left"><select name="product_option[<?php echo $option_row; ?>][product_option_value][<?php echo $option_value_row; ?>][if_default]" class="form-control">
                      <?php if ( isset($product_option_value['if_default']) && $product_option_value['if_default']) { ?>
                      <option value="1" selected="selected"><?php echo $text_yes; ?></option>
                      <option value="0"><?php echo $text_no; ?></option>
                      <?php } else { ?>
                      <option value="1"><?php echo $text_yes; ?></option>
                      <option value="0" selected="selected"><?php echo $text_no; ?></option>
                      <?php } ?>
                    </select></td>
]]>
            </add>
        </operation>
    </file>
    
    <file name="admin/controller/catalog/product.php">
        <operation info="增加多语言支持">
            <search position="after">
                <![CDATA[protected function getForm() {]]>
            </search>
            <add><![CDATA[
$this->load->language('catalog/option_set_default');
$data['text_optionsetdefault'] = $this->language->get('text_optionsetdefault');
]]></add>
        </operation>
        <operation info="Add 'default' info | in getForm()">
            <search position="after">
                <![CDATA['quantity'                => $product_option_value['quantity'],]]>
            </search>
            <add><![CDATA['if_default'                => $product_option_value['if_default'],]]></add>
        </operation>
    </file>
    
    <file path="admin/model/catalog/product.php">
        <operation info="Insert new value of 'default' into 'product_option_value' | in addProduct()">
            <search position="replace">
	        <![CDATA[$this->db->query("INSERT INTO " . DB_PREFIX . "product_option_value SET product_option_id = '" . (int)$product_option_id . "', product_id = '" . (int)$product_id . "', option_id = '" . (int)$product_option['option_id'] . "', option_value_id = '" . (int)$product_option_value['option_value_id'] . "', quantity = '" . (int)$product_option_value['quantity'] . "', subtract = '" . (int)$product_option_value['subtract'] . "', price = '" . (float)$product_option_value['price'] . "', price_prefix = '" . $this->db->escape($product_option_value['price_prefix']) . "', points = '" . (int)$product_option_value['points'] . "', points_prefix = '" . $this->db->escape($product_option_value['points_prefix']) . "', weight = '" . (float)$product_option_value['weight'] . "', weight_prefix = '" . $this->db->escape($product_option_value['weight_prefix']) . "'");]]>
            </search>
            <add><![CDATA[$this->db->query("INSERT INTO " . DB_PREFIX . "product_option_value SET product_option_id = '" . (int)$product_option_id . "', product_id = '" . (int)$product_id . "', option_id = '" . (int)$product_option['option_id'] . "', option_value_id = '" . (int)$product_option_value['option_value_id'] . "', quantity = '" . (int)$product_option_value['quantity'] . "', subtract = '" . (int)$product_option_value['subtract'] . "', price = '" . (float)$product_option_value['price'] . "', price_prefix = '" . $this->db->escape($product_option_value['price_prefix']) . "', points = '" . (int)$product_option_value['points'] . "', points_prefix = '" . $this->db->escape($product_option_value['points_prefix']) . "', weight = '" . (float)$product_option_value['weight'] . "', weight_prefix = '" . $this->db->escape($product_option_value['weight_prefix']) . "', if_default = '" . (int)$product_option_value['if_default'] . "'" );]]></add>  
        </operation>
        
        <operation info="Insert new value of 'default' into 'product_option_value' | in editProduct()">
            <search position="replace">
	        <![CDATA[$this->db->query("INSERT INTO " . DB_PREFIX . "product_option_value SET product_option_value_id = '" . (int)$product_option_value['product_option_value_id'] . "', product_option_id = '" . (int)$product_option_id . "', product_id = '" . (int)$product_id . "', option_id = '" . (int)$product_option['option_id'] . "', option_value_id = '" . (int)$product_option_value['option_value_id'] . "', quantity = '" . (int)$product_option_value['quantity'] . "', subtract = '" . (int)$product_option_value['subtract'] . "', price = '" . (float)$product_option_value['price'] . "', price_prefix = '" . $this->db->escape($product_option_value['price_prefix']) . "', points = '" . (int)$product_option_value['points'] . "', points_prefix = '" . $this->db->escape($product_option_value['points_prefix']) . "', weight = '" . (float)$product_option_value['weight'] . "', weight_prefix = '" . $this->db->escape($product_option_value['weight_prefix']) . "'");]]>
            </search>
            <add><![CDATA[$this->db->query("INSERT INTO " . DB_PREFIX . "product_option_value SET product_option_value_id = '" . (int)$product_option_value['product_option_value_id'] . "', product_option_id = '" . (int)$product_option_id . "', product_id = '" . (int)$product_id . "', option_id = '" . (int)$product_option['option_id'] . "', option_value_id = '" . (int)$product_option_value['option_value_id'] . "', quantity = '" . (int)$product_option_value['quantity'] . "', subtract = '" . (int)$product_option_value['subtract'] . "', price = '" . (float)$product_option_value['price'] . "', price_prefix = '" . $this->db->escape($product_option_value['price_prefix']) . "', points = '" . (int)$product_option_value['points'] . "', points_prefix = '" . $this->db->escape($product_option_value['points_prefix']) . "', weight = '" . (float)$product_option_value['weight'] . "', weight_prefix = '" . $this->db->escape($product_option_value['weight_prefix']) . "', if_default = '" . (int)$product_option_value['if_default'] . "'" );]]></add>  
        </operation>
        
        <operation info="Add value of 'default' into $product_option_value_data | in getProductOptions()">
            <search position="before">
                <![CDATA['quantity'                => $product_option_value['quantity'],]]>
            </search>
            <add><![CDATA[						'if_default'                 => $product_option_value['if_default'],]]></add>
        </operation>
    </file>
    
    <file name="catalog/model/catalog/product.php">   
        <operation info="Add value of 'default' into $product_option_value_data | in getProductOptions()">
            <search position="before">
                <![CDATA['quantity'                => $product_option_value['quantity'],]]>
            </search>
            <add><![CDATA[						'if_default'                 => $product_option_value['if_default'],]]></add>
        </operation>
    </file>
    
    <file name="catalog/controller/product/product.php" error="log">   
        <operation info="Add value of 'default' into $option_value_data | in index()">
            <search position="after">
                <![CDATA['name'                    => $option_value['name'],]]>
            </search>
            <add><![CDATA[								'if_default'                 => $option_value['if_default'],]]></add>
        </operation>
    </file>
    
    <file name="catalog/view/theme/default/template/product/product.tpl">   
        <operation info="rewrite select options">
            <search position="replace" offset="11">
                <![CDATA[            <?php if ($option['type'] == 'select') { ?>]]>
            </search>
            <add><![CDATA[            <?php if ($option['type'] == 'select') { ?>
            <div class="form-group<?php echo ($option['required'] ? ' required' : ''); ?>">
              <label class="control-label" for="input-option<?php echo $option['product_option_id']; ?>"><?php echo $option['name']; ?></label>
              <select name="option[<?php echo $option['product_option_id']; ?>]" id="input-option<?php echo $option['product_option_id']; ?>" class="form-control">
<?php 

    $st_flag = true;
    foreach ($option['product_option_value'] as $option_value) {
        $selected = "";
        if ( (int)$option_value['if_default'] && $st_flag ):
            $st_flag = false;
            $selected = "selected";
        endif;
?>
            <option value="<?php echo $option_value['product_option_value_id']; ?>" <?php echo $selected; ?>><?php echo $option_value['name']; ?>
            <?php if ($option_value['price']) { ?>
            (<?php echo $option_value['price_prefix']; ?><?php echo $option_value['price']; ?>)
            <?php } ?>
            </option>
            <?php } ?>
]]>
            </add>
        </operation>
        
        <operation info="rewrite radio options">
            <search position="replace" offset="17">
                <![CDATA[            <?php if ($option['type'] == 'radio') { ?>]]>
            </search>
            <add><![CDATA[
<?php 
    if ($option['type'] == 'radio') { 
        $st_flag = true;
?>
        <div class="form-group<?php echo ($option['required'] ? ' required' : ''); ?>">
              <label class="control-label"><?php echo $option['name']; ?></label>
              <div id="input-option<?php echo $option['product_option_id']; ?>">
                <?php foreach ($option['product_option_value'] as $option_value) { 
                          $checked = "";
                          if ( (int)$option_value['if_default'] && $st_flag ):
                              $st_flag = false;
                              $checked = "checked";
                          endif;
                ?>
                <div class="radio">
                  <label>
                    <input type="radio" name="option[<?php echo $option['product_option_id']; ?>]" value="<?php echo $option_value['product_option_value_id']; ?>" <?php echo $checked;?>/>
                    <?php echo $option_value['name']; ?>
                    <?php if ($option_value['price']) { ?>
                    (<?php echo $option_value['price_prefix']; ?><?php echo $option_value['price']; ?>)
                    <?php } ?>
                  </label>
                </div>
                <?php } ?>
              </div>
            </div>
            <?php } ?>
]]>
            </add>
        </operation>
        
        <operation info="rewrite checkbox options">
            <search position="replace" offset="17">
                <![CDATA[            <?php if ($option['type'] == 'checkbox') { ?>]]>
            </search>
            <add><![CDATA[
<?php 
    if ($option['type'] == 'checkbox') {
        $st_flag = true;
?>
        <div class="form-group<?php echo ($option['required'] ? ' required' : ''); ?>">
              <label class="control-label"><?php echo $option['name']; ?></label>
              <div id="input-option<?php echo $option['product_option_id']; ?>">
                <?php foreach ($option['product_option_value'] as $option_value) { 
                          $checked = "";
                          if ( (int)$option_value['if_default'] && $st_flag ):
                              //$st_flag = false;
                              $checked = "checked";
                          endif;
                ?>
                <div class="checkbox">
                  <label>
                    <input type="checkbox" name="option[<?php echo $option['product_option_id']; ?>][]" value="<?php echo $option_value['product_option_value_id']; ?>" <?php echo $checked; ?>/>
                    <?php echo $option_value['name']; ?>
                    <?php if ($option_value['price']) { ?>
                    (<?php echo $option_value['price_prefix']; ?><?php echo $option_value['price']; ?>)
                    <?php } ?>
                  </label>
                </div>
                <?php } ?>
              </div>
            </div>
            <?php } ?>
]]>
            </add>
        </operation>
        
        <operation info="rewrite image options" error="log">
            <search position="replace" offset="17">
                <![CDATA[<?php if ($option['type'] == 'image') { ?>]]>
            </search>
            <add><![CDATA[
<?php 
    if ($option['type'] == 'image') {
        $st_flag = true;
?>
        <div class="form-group<?php echo ($option['required'] ? ' required' : ''); ?>">
              <label class="control-label"><?php echo $option['name']; ?></label>
              <div id="input-option<?php echo $option['product_option_id']; ?>">
                <?php foreach ($option['product_option_value'] as $option_value) { 
                          $checked = "";
                          if ( (int)$option_value['if_default'] && $st_flag ):
                              $st_flag = false;
                              $checked = "checked";
                          endif;
                ?>
                <div class="radio">
                  <label>
                    <input type="radio" name="option[<?php echo $option['product_option_id']; ?>]" value="<?php echo $option_value['product_option_value_id']; ?>" <?php echo $checked;?> />
                    <img src="<?php echo $option_value['image']; ?>" alt="<?php echo $option_value['name'] . ($option_value['price'] ? ' ' . $option_value['price_prefix'] . $option_value['price'] : ''); ?>" class="img-thumbnail" /> <?php echo $option_value['name']; ?>
                    <?php if ($option_value['price']) { ?>
                    (<?php echo $option_value['price_prefix']; ?><?php echo $option_value['price']; ?>)
                    <?php } ?>
                  </label>
                </div>
                <?php } ?>
              </div>
            </div>
            <?php } ?>
]]>
            </add>
        </operation>
    </file>
    
    <file name="catalog/view/theme/journal2/template/product/product.tpl" error="log">   
        <operation info="rewrite select options for journal theme">
            <search position="replace" offset="13">
                <![CDATA[            <?php if ($option['type'] == 'select') { ?>]]>
            </search>
            <add><![CDATA[            <?php if ($option['type'] == 'select') { ?>
            <div class="option form-group<?php echo ($option['required'] ? ' required' : ''); ?> option-<?php echo $option['type']; ?>">
                <label class="control-label" for="input-option<?php echo $option['product_option_id']; ?>"><?php echo $option['name']; ?></label>
                <select name="option[<?php echo $option['product_option_id']; ?>]" id="input-option<?php echo $option['product_option_id']; ?>" class="form-control">
                    <option value=""><?php echo $text_select; ?></option>
<?php 

    $st_flag = true;
    foreach ($option['product_option_value'] as $option_value) {
        $selected = "";
        if ( (int)$option_value['if_default'] && $st_flag ):
            $st_flag = false;
            $selected = "selected";
        endif;
?>
            <option value="<?php echo $option_value['product_option_value_id']; ?>" <?php echo $selected; ?>><?php echo $option_value['name']; ?>
            <?php if ($option_value['price']) { ?>
            (<?php echo $option_value['price_prefix']; ?><?php echo $option_value['price']; ?>)
            <?php } ?>
            </option>
            <?php } ?>
        </select>
    </div>
]]>
            </add>
        </operation>
        
        <operation info="rewrite radio options">
            <search position="replace" offset="17">
                <![CDATA[            <?php if ($option['type'] == 'radio') { ?>]]>
            </search>
            <add><![CDATA[
<?php 
    if ($option['type'] == 'radio') { 
        $st_flag = true;
?>
        <div class="option form-group<?php echo ($option['required'] ? ' required' : ''); ?> option-<?php echo $option['type']; ?>">
              <label class="control-label"><?php echo $option['name']; ?></label>
              <div id="input-option<?php echo $option['product_option_id']; ?>">
                <?php foreach ($option['product_option_value'] as $option_value) { 
                          $checked = "";
                          if ( (int)$option_value['if_default'] && $st_flag ):
                              $st_flag = false;
                              $checked = "checked";
                          endif;
                ?>
                <div class="radio">
                  <label>
                    <input type="radio" name="option[<?php echo $option['product_option_id']; ?>]" value="<?php echo $option_value['product_option_value_id']; ?>" <?php echo $checked;?>/>
                    <?php echo $option_value['name']; ?>
                    <?php if ($option_value['price']) { ?>
                    (<?php echo $option_value['price_prefix']; ?><?php echo $option_value['price']; ?>)
                    <?php } ?>
                  </label>
                </div>
                <?php } ?>
              </div>
            </div>
            <?php } ?>
]]>
            </add>
        </operation>
        
        <operation info="rewrite checkbox options">
            <search position="replace" offset="17">
                <![CDATA[            <?php if ($option['type'] == 'checkbox') { ?>]]>
            </search>
            <add><![CDATA[
<?php 
    if ($option['type'] == 'checkbox') {
        $st_flag = true;
?>
        <div class="option form-group<?php echo ($option['required'] ? ' required' : ''); ?> option-<?php echo $option['type']; ?>">
              <label class="control-label"><?php echo $option['name']; ?></label>
              <div id="input-option<?php echo $option['product_option_id']; ?>">
                <?php foreach ($option['product_option_value'] as $option_value) { 
                          $checked = "";
                          if ( (int)$option_value['if_default'] && $st_flag ):
                              //$st_flag = false;
                              $checked = "checked";
                          endif;
                ?>
                <div class="checkbox">
                  <label>
                    <input type="checkbox" name="option[<?php echo $option['product_option_id']; ?>][]" value="<?php echo $option_value['product_option_value_id']; ?>" <?php echo $checked; ?>/>
                    <?php echo $option_value['name']; ?>
                    <?php if ($option_value['price']) { ?>
                    (<?php echo $option_value['price_prefix']; ?><?php echo $option_value['price']; ?>)
                    <?php } ?>
                  </label>
                </div>
                <?php } ?>
              </div>
            </div>
            <?php } ?>
]]>
            </add>
        </operation>
        
        <operation info="rewrite image options" error="log">
            <search position="replace" offset="17">
                <![CDATA[<?php if ($option['type'] == 'image') { ?>]]>
            </search>
            <add><![CDATA[
<?php 
    if ($option['type'] == 'image') {
        $st_flag = true;
?>
        <div class="option form-group<?php echo ($option['required'] ? ' required' : ''); ?> option-<?php echo $option['type']; ?>">
              <label class="control-label"><?php echo $option['name']; ?></label>
              <div id="input-option<?php echo $option['product_option_id']; ?>">
                <?php foreach ($option['product_option_value'] as $option_value) { 
                          $checked = "";
                          if ( (int)$option_value['if_default'] && $st_flag ):
                              $st_flag = false;
                              $checked = "checked";
                          endif;
                ?>
                <div class="radio">
                  <label>
                    <input type="radio" name="option[<?php echo $option['product_option_id']; ?>]" value="<?php echo $option_value['product_option_value_id']; ?>" <?php echo $checked; ?> />
                    <img src="<?php echo $option_value['image']; ?>" alt="<?php echo $option_value['name'] . ($option_value['price'] ? ' ' . $option_value['price_prefix'] . $option_value['price'] : ''); ?>" class="img-thumbnail" /> <?php echo $option_value['name']; ?>
                    <?php if ($option_value['price']) { ?>
                    (<?php echo $option_value['price_prefix']; ?><?php echo $option_value['price']; ?>)
                    <?php } ?>
                  </label>
                </div>
                <?php } ?>
              </div>
            </div>
            <?php } ?>
]]>
            </add>
        </operation>
    </file>
</modification>